# 酒店空调管理系统 - 部署指南

> 让后端同学可以通过公网域名访问前端进行测试

---

## 🚀 方案一：使用 ngrok 内网穿透（最快，5分钟搞定）

**适用场景**：快速分享本地前端给后端同学测试

**优点**：
- ✅ 5分钟搞定
- ✅ 无需注册账号（免费版）
- ✅ 支持 HTTPS
- ✅ 不需要部署

**缺点**：
- ⚠️ 免费版每次重启地址会变
- ⚠️ 需要你的电脑一直开着
- ⚠️ 后端同学需要在本地运行后端（或也用 ngrok 暴露后端）

---

### 步骤 1：下载安装 ngrok

#### Windows:
1. 访问：https://ngrok.com/download
2. 点击 "Download for Windows"
3. 解压 `ngrok.zip` 到任意文件夹（如 `C:\ngrok`）
4. 将 ngrok 路径添加到系统环境变量（可选）

#### 或使用命令行安装：
```bash
# 使用 Chocolatey（如果已安装）
choco install ngrok

# 或使用 Scoop（如果已安装）
scoop install ngrok
```

---

### 步骤 2：启动前端服务

```bash
cd hotel-ac-frontend
npm run dev
```

前端会运行在：`http://localhost:5173`

---

### 步骤 3：启动 ngrok 穿透

打开**新的命令行窗口**，运行：

```bash
# 方法1：如果 ngrok 在环境变量中
ngrok http 5173

# 方法2：如果解压到了 C:\ngrok
cd C:\ngrok
ngrok.exe http 5173
```

你会看到类似的输出：
```
ngrok

Session Status                online
Account                       (Plan: Free)
Version                       3.x.x
Region                        Asia Pacific (ap)
Latency                       50ms
Web Interface                 http://127.0.0.1:4040
Forwarding                    https://abc123.ngrok.io -> http://localhost:5173

Connections                   ttl     opn     rt1     rt5     p50     p90
                              0       0       0.00    0.00    0.00    0.00
```

**重要**：复制 `Forwarding` 后面的 HTTPS 地址，例如：
```
https://abc123.ngrok.io
```

---

### 步骤 4：分享给后端同学

发给后端同学：

```
前端访问地址：https://abc123.ngrok.io

可用的页面：
- 客户端：https://abc123.ngrok.io/room/301
- 管理员端：https://abc123.ngrok.io/admin
- 前台服务台：https://abc123.ngrok.io/reception
- 酒店经理端：https://abc123.ngrok.io/manager
```

---

### 步骤 5：后端同学如何对接？

**方案A：后端同学在本地运行后端**

后端同学需要：
1. 启动后端服务在 `http://localhost:3000`
2. 修改前端 `.env` 文件中的后端地址为他们本地的地址
3. **问题**：前端已部署，无法连接到他们本地的后端

❌ **这个方案行不通！**

**方案B：你也用 ngrok 暴露后端（推荐）**

1. 启动你的 mock server：
```bash
npm run mock
```

2. 在**第三个命令行窗口**运行：
```bash
ngrok http 3000
```

3. 复制后端的 ngrok 地址，例如：
```
https://xyz789.ngrok.io
```

4. 修改前端的 `.env` 文件：
```env
VITE_API_BASE_URL=https://xyz789.ngrok.io/api
VITE_WS_URL=https://xyz789.ngrok.io
```

5. **重启前端**：
```bash
# Ctrl+C 停止前端
npm run dev
```

6. 分享给后端同学：
```
前端地址：https://abc123.ngrok.io
后端地址：https://xyz789.ngrok.io
后端同学可以根据接口文档实现自己的后端，然后替换这个地址
```

---

### 步骤 6：保持运行

保持三个命令行窗口运行：
- 窗口1：前端（npm run dev）
- 窗口2：后端（npm run mock）
- 窗口3：ngrok 前端（ngrok http 5173）
- 窗口4：ngrok 后端（ngrok http 3000）

**注意**：
- 只要你的电脑开着，后端同学就能访问
- 关闭电脑或关闭窗口后，链接失效
- 免费版每次重启 ngrok，地址会变

---

## 🌐 方案二：部署到 Vercel（永久域名，推荐用于演示）

**适用场景**：给多人展示，或需要永久访问地址

**优点**：
- ✅ 免费
- ✅ 永久域名（xxx.vercel.app）
- ✅ 自动 HTTPS
- ✅ 不需要电脑一直开着
- ✅ 支持自动部署

**缺点**：
- ⚠️ 需要注册 GitHub 和 Vercel 账号
- ⚠️ 后端也需要部署到公网

---

### 步骤 1：准备工作

1. 注册 GitHub 账号（如果没有）：https://github.com
2. 注册 Vercel 账号：https://vercel.com（使用 GitHub 登录）
3. 安装 Git（如果没有）：https://git-scm.com/download/win

---

### 步骤 2：初始化 Git 仓库

在项目目录运行：

```bash
cd hotel-ac-frontend

# 初始化 Git
git init

# 添加所有文件
git add .

# 提交
git commit -m "Initial commit"
```

---

### 步骤 3：推送到 GitHub

1. 在 GitHub 创建新仓库：
   - 访问：https://github.com/new
   - Repository name: `hotel-ac-frontend`
   - 选择 Private（私有）或 Public（公开）
   - 点击 "Create repository"

2. 推送代码：
```bash
# 替换为你的 GitHub 用户名
git remote add origin https://github.com/你的用户名/hotel-ac-frontend.git
git branch -M main
git push -u origin main
```

---

### 步骤 4：部署到 Vercel

#### 方法A：通过 Vercel 网站（推荐）

1. 访问：https://vercel.com
2. 登录后点击 "Add New" → "Project"
3. 选择你刚才创建的 GitHub 仓库
4. 配置环境变量：
   ```
   VITE_API_BASE_URL = https://你的后端地址/api
   VITE_WS_URL = https://你的后端地址
   ```
5. 点击 "Deploy"

#### 方法B：使用 Vercel CLI（可选）

```bash
# 安装 Vercel CLI
npm install -g vercel

# 登录
vercel login

# 部署
vercel

# 按提示操作，选择项目配置
```

---

### 步骤 5：获取部署地址

部署完成后，Vercel 会给你一个地址：
```
https://hotel-ac-frontend-xxx.vercel.app
```

分享给后端同学：
```
前端地址：https://hotel-ac-frontend-xxx.vercel.app

可用页面：
- 客户端：https://hotel-ac-frontend-xxx.vercel.app/room/301
- 管理员端：https://hotel-ac-frontend-xxx.vercel.app/admin
- 前台服务台：https://hotel-ac-frontend-xxx.vercel.app/reception
- 酒店经理端：https://hotel-ac-frontend-xxx.vercel.app/manager
```

---

### 步骤 6：后端对接

**重要**：部署到 Vercel 后，前端无法连接到 `localhost:3000`

后端同学有两个选择：

#### 选项1：后端也部署到公网

后端同学可以：
- 部署到 Heroku、Railway、Render 等平台
- 或使用 ngrok 临时暴露本地后端

然后在 Vercel 项目设置中更新环境变量：
```
Settings → Environment Variables
VITE_API_BASE_URL = https://后端地址/api
VITE_WS_URL = https://后端地址
```

更新后需要重新部署（Vercel 会自动触发）。

#### 选项2：使用 Mock Server（推荐用于演示）

我们的项目已经包含 mock-server.js，可以这样做：

1. 将 mock-server.js 也部署到 Vercel
2. 或部署到其他支持 Node.js 的平台
3. 更新环境变量指向 Mock Server

---

## 📦 方案三：部署 Mock Server 到 Render（免费）

让 mock-server.js 也能在公网访问。

### 步骤 1：准备 Mock Server

确保 `package.json` 中有启动脚本：
```json
{
  "scripts": {
    "start": "node mock-server.js",
    "mock": "node mock-server.js"
  }
}
```

### 步骤 2：推送到 GitHub

（如果已经推送，跳过此步）

### 步骤 3：部署到 Render

1. 访问：https://render.com
2. 注册并登录（使用 GitHub）
3. 点击 "New +" → "Web Service"
4. 连接 GitHub 仓库
5. 配置：
   - Name: `hotel-ac-mock-server`
   - Environment: `Node`
   - Build Command: `npm install`
   - Start Command: `npm start`
6. 点击 "Create Web Service"

### 步骤 4：获取后端地址

部署完成后，Render 会给你一个地址：
```
https://hotel-ac-mock-server.onrender.com
```

### 步骤 5：更新前端环境变量

在 Vercel 项目设置中：
```
VITE_API_BASE_URL = https://hotel-ac-mock-server.onrender.com/api
VITE_WS_URL = https://hotel-ac-mock-server.onrender.com
```

---

## 🎯 推荐方案总结

### 快速测试（今天就要用）
使用 **ngrok**：
- 前端：`ngrok http 5173`
- 后端：`ngrok http 3000`
- 5分钟搞定

### 长期演示（给多人看）
使用 **Vercel + Render**：
- 前端部署到 Vercel
- Mock Server 部署到 Render
- 永久域名，随时访问

---

## 💡 给后端同学的说明

### 如果前端已部署到 ngrok

```
前端地址：https://abc123.ngrok.io
后端地址：https://xyz789.ngrok.io

你们可以：
1. 查看接口文档：/后端对接总文档.md
2. 访问前端测试界面
3. 根据文档实现后端接口
4. 让前端同学修改 .env 指向你们的后端地址
```

### 如果前端已部署到 Vercel

```
前端地址：https://hotel-ac-frontend-xxx.vercel.app

你们需要：
1. 部署后端到公网（或使用 ngrok）
2. 提供后端地址给前端同学
3. 前端同学会在 Vercel 更新环境变量
```

---

## 🔧 常见问题

### Q1: ngrok 地址每次都变怎么办？

**方案1**：注册 ngrok 账号（免费）
```bash
# 注册后获取 authtoken
ngrok config add-authtoken 你的token

# 使用固定子域名（需要付费计划）
```

**方案2**：使用 Vercel 部署，一次配置，永久使用

---

### Q2: 后端同学说连不上怎么办？

**检查清单**：
- ✅ 前端和后端的 ngrok 都在运行吗？
- ✅ .env 中的地址更新了吗？
- ✅ 重启前端了吗？（修改 .env 后需要重启）
- ✅ 后端是否配置了 CORS？
- ✅ 浏览器控制台有报错吗？

---

### Q3: Vercel 部署失败怎么办？

**常见原因**：
- ✅ 检查 `package.json` 中的 `build` 脚本
- ✅ 检查是否有语法错误
- ✅ 查看 Vercel 部署日志

**解决方案**：
```bash
# 本地测试构建
npm run build

# 如果本地构建成功，Vercel 也应该成功
```

---

### Q4: 能用自己的域名吗？

可以！在 Vercel 项目设置中：
1. Settings → Domains
2. 添加你的域名
3. 按提示配置 DNS

---

## 📞 需要帮助？

- 📖 Vercel 文档：https://vercel.com/docs
- 📖 ngrok 文档：https://ngrok.com/docs
- 📖 Render 文档：https://render.com/docs

---

**祝部署顺利！** 🎉

---

**文档维护**: gzs
**最后更新**: 2025-11-25
