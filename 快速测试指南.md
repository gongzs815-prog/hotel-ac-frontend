# 快速测试指南

## 一、启动服务

### 后端（你们开发的）
```bash
# 启动后端服务器，确保运行在
http://localhost:3000
```

### 前端（我这边）
```bash
cd hotel-ac-frontend
npm install
npm run dev

# 访问
http://localhost:5173/room/301
```

---

## 二、API 测试（用 Postman）

### 测试 1: 开机
```
POST http://localhost:3000/api/ac/request-service

Body:
{
  "roomId": "301",
  "currentTemp": 28.0
}

预期返回:
{
  "success": true,
  "mode": "Cooling",
  "targetTemp": 25.0,
  "fanSpeed": "Mid",
  "feeRate": 1.0,
  "status": "serving",
  "waitTime": 0
}
```

### 测试 2: 设置温度
```
POST http://localhost:3000/api/ac/set-temperature

Body:
{
  "roomId": "301",
  "targetTemp": 22.0
}

预期返回:
{
  "success": true,
  "message": "温度设置成功"
}
```

### 测试 3: 设置风速
```
POST http://localhost:3000/api/ac/set-fan-speed

Body:
{
  "roomId": "301",
  "fanSpeed": "High"
}

预期返回:
{
  "success": true,
  "statusChanged": false
}
```

### 测试 4: 查询状态
```
GET http://localhost:3000/api/ac/room-status/301

预期返回:
{
  "success": true,
  "isPowerOn": true,
  "currentTemp": 26.5,
  "targetTemp": 22.0,
  "fanSpeed": "High",
  "mode": "Cooling",
  "totalFee": 1.50,
  "feeRate": 1.0,
  "status": "serving"
}
```

### 测试 5: 关机
```
POST http://localhost:3000/api/ac/stop-service

Body:
{
  "roomId": "301"
}

预期返回:
{
  "success": true,
  "message": "关机成功"
}
```

---

## 三、WebSocket 测试

### 连接地址
```
http://localhost:3000
```

### 测试步骤
```
1. 客户端连接后，发送 join-room 事件:
   { "roomId": "301" }

2. 后端应该开始推送:
   - temperature-update（每 1-3 秒）
   - fee-update（每 1-3 秒）

3. 状态变化时推送:
   - status-change
   - service-started
   - service-stopped
```

---

## 四、前后端联调

### 联调步骤
```
1. 启动后端 → http://localhost:3000
2. 启动前端 → http://localhost:5173
3. 访问 http://localhost:5173/room/301
4. 点击"开启电源"
5. 检查后端是否收到请求
6. 检查前端是否显示正确状态
```

### 检查清单
```
✅ 开机 → 状态变为"服务中"
✅ 温度调节 → 温度实时变化
✅ 风速切换 → 费率立即更新
✅ 费用 → 实时累加
✅ 关机 → 状态变为"已关闭"
```

---

## 五、常见问题

### Q1: 前端显示"服务器无响应"
```
检查：
✅ 后端是否启动
✅ 端口是否是 3000
✅ CORS 是否配置
```

### Q2: WebSocket 连接失败
```
检查：
✅ Socket.io 是否安装
✅ 端口是否正确
✅ 事件名是否匹配
```

### Q3: 接口返回 404
```
检查：
✅ 路由路径是否正确
✅ 是否有 /api 前缀
```

